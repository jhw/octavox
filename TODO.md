### short [01-s3-banks]

- environment variables
- scripts to create/list/empty/delete assets bucket
- add protection to empty bucket action
- dump_pico_banks.py to push to s3 bucket
  - with pico prefix
- bank loading to load from s3
  - flat structure, ignore pico prefix
- local tmp bank cache
  - save to tmp if stuff doesn't exist
  - load from tmp if it does exist
  
### medium

- s3 archives
- bank level bans
- action to fix a track
- mutate and arrange actions
- chord support

### demos

- check delay scales as bpm changes
- replace oh/ch with filter movement
- euclid beats
- vorhosbn noise hats
- t60 collapse clustering
- city dreams bass + vitling 303
- breakbreaks bank

- pydub granular samples -> chord slice concatenation
- pydub fadeouts
- pydub get/change pitch
- pydub timestretching
- pybub detecting crossover points

### banks

- dataline juno
- polyend tracker
- perkons

### thoughts

- samplebass heartbeat?
  - probably not worth it
- exponential cutoff level factor?
  - probably not worth it
- convert samplekey to real class with empty params, tags by default
  - no because needs to be rendered to JSON as part of Samples class
- should pool.add check for same sample with different tags only?
  - not sure
- remove dseed, dstyle?
  - no; given slice model, you don't want to *force* mutation of every slice
- fix_sample protection against specifying unknown tag?
  - feels like overkill
- pass explicit modules and links args to project?
  - no because then you have to distinguish between input and outout modules eg with modconfig
  - its simpler just to have a config variable
  - but be explicit about what's being passed
- sample bans?
  - not clear how it would work
  - feels like over- optimisation
- config classes?
  - feels like overkill; see NOTES.md
- treat svdrum as a sample, so can be fixed?
  - probably too much work
- unfix_sample?
  - not sure it is required
- cli mute/ban samples?
  - hard to see this has much value if there is a lot of randomisation avaiable
- params types?
  - not clear it is worth it

```
>>> show_patch 0
EXCEPTION: Traceback (most recent call last):
  File "/Users/jhw/work/octavox/octavox/modules/cli.py", line 56, in wrapped
    return fn(self, **kwargs)
  File "/Users/jhw/work/octavox/octavox/projects/picobeats/cli.py", line 97, in do_show_patch
    value=trig["key"].short_label if "key" in trig else "sv/%i" % trig["id"]
AttributeError: 'dict' object has no attribute 'short_label'
```

- ^^^ where did this come from?

- dedicated blocks model?
  - no; think it makes more sense to render at the patches level but then have cli work in blocks
- show_patch to iterate over all track keys and check if is a sample?
  - probably not worth it
- SVTrg class
  - not worth it just to replace short label rendering code in cli show_patch
- cli replace|ban samples
  - may be over optimised
- initialise lfo with randomised step?
  - not sure it's worth it
- ability to specify track key when copying?
  - not clear that this is useful if fix() functionality is implemented
- cli blend() action?
  - hard to know how it should be implemented or if it would be useful
- validation to check custom sampler classes exist?
  - is over- optimisation
- pass config around?
  - problem is how to use it in decorators
  - easier to load at cli level and validate there as it's a yaml file
- blacklist
  - is over- optimising
- don't like naming of `tracks=SVPatch()` in model
- breaks for concat action?
- add back slicetemp? 
  - feels like an over- optimisation, and too much passing stuff around
- add sample to add current patch to pool?
  - probably overkill
- pass array of roots to chain?
  - feels like this is extra complexity for little benefit
- better forcing of echo wet zero option?
  - no is over- optimised
- simplify vitling wrappers?
  - problem is the need to pass sample keys, different for each track
- cli chain sample overloading?
  - I don't think this is necessary now since the number of stored samples has been reduced, there are is less scope for random samples being introduced into mutations
  - although still some room, given the degrees of freedom of the pattern model
- watcher to check code is working?
  - seems like overkill
- tracks to iterate over slices and lfos not config items?
  - dunno
- notes should be list not dict?
  - dunno
- runtine checkes for mod/ctrl refs in lfo config?
   - probably overkill
- global mutes?
  - doesn't make much sense
  - can mute track in UI when experimenting
  - can ignore track when using OT as you have all tracks independently
- abstract sample filtering into patch? 
  - not possible because patch needs rendering before filterig
- track- level render block?
  - mutes, nbeats, nbreaks?
  - not sure it makes sense
- sunvox stops?
- randomiser filename to include pool name?
  - feels like over- optimisation
- make (bank, wavfile) a tuple on creation?
  - but then u can't save to JSON
  - at least not without custom encode/decode
- sample similarity clustering?

### done

- moved render_patches into root cli
- add cli variables for modules, links
- split config and move inline under separate variables
- check what happens if link module unknown
- resonance parameter
- parameterise filter scaling with cli args
- set filter type in filter config
- refactor filter cutoff scaling to use absolute values
- remove fx value scaling at SVFXTrig level
  - add multipier as slicebeats LFO config variable
- pass seed
- add timestamp as output prefix
- rename limit as density
- random filter levels
- use lookups when loading sa,ples
- pass base sample from command line
- json serialisation error on adding params to samplebass
- test cutoff with samplebass demo
- creation of SVNoteTrig to automatically insert mod into samplekey tags
- move octavox/scripts into new scripts, demos directories
- update credits
- refactor scripts/dump_pico_projects.py
- remove flatten
- fix show_samples
- notes on why samples can't be a pool
- add pool values property
- creation of filtered should use pool.lookup
- refactor samplekeys nomeclature as samples or pool
- pool.lookup() should return another pool
  - model Samples code will need changing
- pass pool to sampler
- samplekey base_key and full_key properties
- eliminate calls to str(samplekey)
- change cutoff, slice to index from 0 and remove protection
- start, end parameters
- cutoff, slice implementations
- move segment handling into decorator
- new sample_key, segment_key fields for samplekey
- use segment key in sampler
- refactor sampler pydub code
- rename sliceparams as simply params
- pool add() method to avoid doing `pool[str(samplekey)]=samplekey`
- move mutation code into cli
- pydub demo to export to in- memory binary data
- new optional samplekey params field which renders as JSON dict in str
- investigate how existing sampler copies data to slot (lookup?)
- move banks into directory and have separate sampler module
- make samplekey tags optional
- tags to be rendered as list at end of str(samplekey)
- ensure tags are sorted in str() for consistency
- remove comment about polymorphic samplers
- consider raising RuntimeError if no samplekeys with mod tag found
- CREDITS.md, INSPIRATION.md
- rename sampler as BankSampler and move into banks
- pydub
  - https://stackoverflow.com/questions/44424874/read-from-bytes-not-filename-to-convert-audio
- dump wavfile
- rename picobeats as slicebeats
- replace Fixes with SVPool
- cull pools on loading
- add samples lookup code which uses full pool if no matches are found
- check samples lookup code
- refactor SVPool as per cli Fixes
- runtime name reference checking
- remove pool validation stuff
- add lookup method to SVPool as per fixes
- convert samples lookup to act polymorphically wrt to pool and fixes
- migrations to save to migrations dir
- dedicate migrations class
- migrate ids to names
- rename id as name
- aws config
- new inline Sequencer/LfoConfig classes which wrap seq_id, lfo_id methods or properties
- link re python pitch shifting
- pass explicit modules and links to project
- move module layout initialisation into modules.py
- move colour stuff into modules.py
- separate layout from project
- separate project name from outside
- consider moving tags out of config
- update archive
- fix bads refs to `%s/%s % (outdir+"/json", etc)`
- samples are badly named (Kick not KK etc)
- need a save project action
- replace sequencer key with id [mod]
- samples is now a list with tags field [array values]
- mutes are no longer part of structure
- density (0.75) is now contained at the root patch level
- replace lfo key with id [mod/ctrl]
- refactor fixes to utilise tag structure
- fixes to become a standard dict
- add lookup method for tag
- fix_sample is failing
- samples to be saved as list
- rename soundkeys as tags
- loading and cloning fails because samplekey isn't converted from dict to SampleKey class on loading project
- add multiple tag support for samplekey
- mutes 
- convert samplekey mod to tag
- density stored at patch level 
- volume and BPM variables
- rename show patch as show samples
- complete refactoring of show_patch
- sequencer to clone samplekey since updating with mod
  - add note re overwriting of module
- trig to use key rather than samplekey ref
- refactor samplekey as soundkey unless it is a samplekey class
- remove mutes
- move flatten, Q into projects/__init__
- move instruments into config and rename as samplegroups 
- refactor key as samplekey in trig class
- rename samplekey, inst as samplegroup
- consider if cli needs to import Instruments
- convert dict- based SV classes to real classes
- refactor use of key for sample randomisation
- see if key can be eliminated from seq/lfo initialisation
- replace key used by init_machine with id parameter
- separate usage of key to a) randomise samples and b) lookup seq/lfo config
- move init_machine inline
- replace passing of key to slice for style lookup, with direct passing of styles
- check if both tracks and trigs need nbeats variable
- model to use trigs class not tracks and to append to trigs
- project to use trigs.tracks
- new SVTrigs class (list) which can spawn Tracks
- new track_key property for trig classes
  - uses mod and/or mod+ctrl
- remove keys from modules and remove associated validation code
- replace sample keys with mod names
- rename svpatch as svtracks
- extend basecli not poolcli (?)
- vitling patterns
- reduce config to single sampler
- pitch shifter
- install pyaudio
- remove instruments
- change sequence to mirror lfo
- remove slices
- remove patterns
- remove mutes
- remove temperature
- remove density
- remove mutate and scatter
- remove picobeats refs
- remove fixes
- remove svdrum
- convert fixes values to use set()
  - check set equality operator
- avoid sample fix duplication
- simplify initialisation of fixes via instrument class which allows you to flatten values
- refactor Samples.randomise 
  - if i==0 and key in fixes and fixes[key]!=[]
- remove pool.randomise
- pass slice index to samples
- add bank.lookup
- remove shortlabel stuff
- arrange action
- mutes
- replace npatches with blocksize and nblocks
- refactor randomisation and mutation to iterate over blocks and patches
- simplify mutation
- move randomisation into cli
- pass filenames containing outdir to patches
- SVTrig class
- encapsulate short_label code in SVTrig
- remove SVSampleKey.create
- add @parse_line type checking
- avoid having to specify @parse_line(config=[])
- refactor current pool indicator
- copy pool to set pool
- copy pool followed by randomise patches fails
- add back wrap_action
  - remove str(frag) to test wrap_action
- remove nbreaks
- remove pitch
- remove mutes
- remove decompile and concat
- SVBankCli
- consider if there are other opportunities to abstract cli
- remove code to create paths on the fly
- abstract base cli
- remove code to create paths on the fly
- cli to be passed output dir and create directory structure
- why do you need a numpy requirement?
- cli history
- move SVEnvironment, random_filename to root
- show_samples to dump short name
- replace show_patch with show_samples
- nero-bellum and pitch-black names aren't being cleaned
- fetch pico stuff to add index prefix to filename
- save pico stuff to picobeats/banks/zipped|projects
- ability to quick view bank list
- load_project fails if passsed string
- show_rendered should be show_samples
- show_rendered doesn't render svdrum trigs
- complete show_samples action 
- check how tmp dirs are being created
- rename chain as decompile
- trig velocity should be an option
- nbreaks should be an option for project rendering
- script to dump pico banks as projects
- add sv prefix to banks, pools etc
- add pitch info to samplekey
- convert samplekey tuples to classes
- complete show samples action by iterating over pattern and dunping formatted row
- implement cli api
- abstract instruments and fragments from banks.py
- move banks.py into modules
- add show() function
- more forensic svdrum mixer levels
- pass config from cli and validate there
- pattern temperature
- check vitling patterns
- try forcing more zero echo wet stuff
- rename patterns.yaml as fragments.yaml?
- svdrum kick volume factors
- refactor sequence render variables
- move code that converts notes to grid into SVPatch
- clean up raw wavfile names 
- rename patterns as fragments
- add SnareDrum for completeness
- svdrum trig needs to switch module to drum
  - single drum module?
  - replace sampler with Drum?
- add svdrum-curated to list of pools
- complete svdrum config
- modify sequence rendering if bank is defined as svdrum 
- validate sequence modules and keys
- validate lfo modules
- abstract single config structure into yaml file
- remove snaredrum as is crap
- add drum modules
- runtime module naming checks
- should be able to rename KKSampler as KickSampler
- check what happens if you change a module key from kk
  - do you need a runtime check here?
- consider moving filter_samples() into SVTrack
- consider renaming patch as tracks
- replace passing of nbeats to init_pattern/blank with property of tracks class
- move patch rendering back into model
- eliminate double call to render
- tracks.render() to return dict so you maintain key information
- load rv/sampler modules dynamically
- move module instantiation and sample gathering into project
  - you might have to walk a structure iteratively in order to find samples
- new concat method taking array
- remove qd
- pattern.randomise classmethod
- add new cli pool method which sets pool
- remove pool from params
- allow param and pool to take blank second arg and work as getters
- fix chain 1000 + mutate 1000
- not convinced chain is generating the right output
- move int parse above array
- handle octachain array conversion inline
- refactor octachain so takes an array of roots 
  - ignores nbeats
  - shouldn't run any mutations itself
- add AxB array support to cli
- fix copy fdest lookup 
  - should lookup prior to creation
- rename chain as octachain
- remove mutate/ chain hack
- copy to use lookups
- (replace clone with add?)
- add pool to add pool to current pool
- convert pool to use set
- pool clone fails
- clone pool to clone existing pool 
- init pool to create empty pool
- `chain 1000` followed by `mutate 1000` returns an error
- check mutate and chain take negative numbers and use moduko
- remove array support 
- remove list prefix from params and pools
- show pool sizes
- @wrap_action is not wrapping errors with (eg) bad density values
- remove env value
- setparam code parsing param updates is a complete mess
- refactor cli validators
  - remove optimistic parse
  - iterate over config with matches_xxx, parse_xxx helpers
- density
- why does it fail with missing sample refs?
- consider ordering rendered tracks
- try eval for validation
- add array support
- remove min handling
- combine parsing of line with parameter validation
- consider adding back cli chain sample munging
- chain mutes are not working
- project -> decorator to attach patch, blank items
- clone error when mutating a loaded file
- shuffle_slice break track idempotency
- should tracks rendering really return n, tracks?
- restrict samples to those used by a particular chain
- avoid duplicating keys
- revert to using keys
- some of the sample offsetting looks very strange (and busy)
- consider not unpacking params at machine level
  - or doing it in a decorator
- chaining fails
- mutation fails

```
 File "/Users/jhw/work/octavox/octavox/projects/picobeats/model.py", line 98, in <listcomp>
    tokens=[int(tok)
ValueError: invalid literal for int() with base 10: ''
```

- mutes arg
- check dual/overloaded calls to constructors
- mutate tracks
- remove cli list support
- initialise samples
- tracks rendering needs to return n, tracks
- remove slicetemp
- pattern initialisation
- slice model 
  - seed, style, samples
- move render_xxx into tracks, lfos
- track patterns and offsets
- merge machines into track and lfo
- relationship between sequencer/lfo Objects and the config items that are used to instantiate them
- lfo json needs to include type and args (range, intervals)
- name parameters when you have long lists
- rename/remove vitling generator
- move lfos from slices to tracks
- abstract vitling beats into common vitling909 module
- zero ctrl values not being rendered
- rename machines as sequencers
- eliminate lfo offsets
- eliminate pattern code from slice rendering
- replace hardcoded instrument lists with config refs
- second feedback lfo
- define lfo mod, controller in config
- separate machine kwargs code at slice level
- remove lfo style
- remove lfo array support
- wet changes not being rendered
- convert append/expand into dual decorator strategy
- list, array support
- revert renderinfo
- env and pool to share common base with abbreviation lookup
- reduce default temperatures
- rename samples as poolname
- add poolname abbreviation matching
- replace enum support with string
  - special setparam code to validate pools
- cli variable to list pools
- make nbeats an environment variable
- move banks into /octavox/banks/pico where they can be shared
  - Banks class also
- pass banks and pool to model
- cli to initialise pools
- cli poolname variable
- banks function to return file handle for bankname/wavfile
- pools.trim to reject anything too small
- pools.spawn_free/curated to add global pools
- remove cli profile variable
- curation script
- remove s3 stuff
- download into local banks directory with unchanged names
- rename slicebeats as picobeats
- remove save
- insert nbreaks automatically but for chain only
  - remove parameter
- define instruments and solos
- chainer to force samples to be the same as mute
- saving
- chainer with mutes
- refactor breaks so they are not voids
- complete load function
- add breaks variable
- add bool support
- simplify os.makedirs
- don't store self.filenmae
- remove pico- prefix from saved s3 files
  - test upload/download again
- include generator in filename
- remove stack
- fix need to remove pico- when downloading sample files
- save patches to json
- remove blender
- maintain internal stack of patches
