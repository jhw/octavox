### short

- rename slicebeats model.py as machines.py
- rename lfos as modulators
- euclidbeats randomise method to randomise a sample
- euclidbeats random euclid pattern
- euclidbeats render euclid notes
- euclidbeats volume importance sampling

### medium

### thoughts

- specify initial controller values in hex space?
  - no because initial values seem to work in uniform space

- granular overlay?
  - https://github.com/jiaaro/pydub/blob/master/API.markdown#audiosegmentoverlay
  - doesn't seem to work :(

```
Traceback (most recent call last):
  File "/Users/jhw/work/octavox/demos/grainpad.py", line 91, in <module>
    project=SVProject().render(patches=patches,
  File "/Users/jhw/work/octavox/octavox/modules/project.py", line 165, in render
    proj.patterns=self.init_patterns(modules=modules,
  File "/Users/jhw/work/octavox/octavox/modules/project.py", line 138, in init_patterns
    self.init_pattern(patterns=patterns,
  File "/Users/jhw/work/octavox/octavox/modules/project.py", line 96, in wrapped
    rvpat=fn(*args, **kwargs)
  File "/Users/jhw/work/octavox/octavox/modules/project.py", line 115, in init_pattern
    return RVPattern(lines=patch.nbeats,
  File "<attrs generated init rv.pattern.Pattern>", line 15, in __init__
  File "/Users/jhw/work/octavox/env/lib/python3.10/site-packages/rv/lib/validators.py", line 12, in validate
    raise ValueError("Value is not in range {}-{}".format(start, end))
ValueError: Value is not in range 1-32
```

- consider converting sample tags to set?
  - not worth it as list is easier to serialise to/from json
- convert pools, banks to lists? 
  - seems to be more trouble that it is really worth
  - because then pool has to store name which makes cloning harder  
- add prefix/string matching to reanimate archives?
  - not sure is required
- investigate why Note (RVNote) seems to need a local import?
  - not a problem that requires solving
- render_patches to take optional filename?
  - problem is it's not that useful
  - would only be useful for reanimate_archives
  - but then you have a lot of files to reanimate, not just a single on
  - ie can't use decorator
- base class for sequencer and lfo?
  - don't think it's required or useful
- bank level bans? 
  - think is over optimisation given randomisation
  - also how would it work with s3?
- samplebass heartbeat?
  - probably not worth it
- exponential cutoff level factor?
  - probably not worth it
- convert samplekey to real class with empty params, tags by default
  - no because needs to be rendered to JSON as part of Samples class
- should pool.add check for same sample with different tags only?
  - not sure
- remove dseed, dstyle?
  - no; given slice model, you don't want to *force* mutation of every slice
- fix_sample protection against specifying unknown tag?
  - feels like overkill
- config classes?
  - feels like overkill; see NOTES.md
- unfix_sample?
  - not sure it is required
- params types?
  - not clear it is worth it
- cli blend() action?
  - hard to know how it should be implemented or if it would be useful
- validation to check custom sampler classes exist?
  - is over- optimisation
- pass config around?
  - problem is how to use it in decorators
  - easier to load at cli level and validate there as it's a yaml file
- blacklist
  - is over- optimising
- don't like naming of `tracks=SVPatch()` in model
- breaks for concat action?
- add back slicetemp? 
  - feels like an over- optimisation, and too much passing stuff around
- add sample to add current patch to pool?
  - probably overkill
- pass array of roots to chain?
  - feels like this is extra complexity for little benefit
- better forcing of echo wet zero option?
  - no is over- optimised
- simplify vitling wrappers?
  - problem is the need to pass sample keys, different for each track
- cli chain sample overloading?
  - I don't think this is necessary now since the number of stored samples has been reduced, there are is less scope for random samples being introduced into mutations
  - although still some room, given the degrees of freedom of the pattern model
- watcher to check code is working?
  - seems like overkill
- tracks to iterate over slices and lfos not config items?
  - dunno
- notes should be list not dict?
  - dunno
- runtine checkes for mod/ctrl refs in lfo config?
   - probably overkill
- global mutes?
  - doesn't make much sense
  - can mute track in UI when experimenting
  - can ignore track when using OT as you have all tracks independently
- abstract sample filtering into patch? 
  - not possible because patch needs rendering before filterig
- track- level render block?
  - mutes, nbeats, nbreaks?
  - not sure it makes sense
- sunvox stops?
- randomiser filename to include pool name?
  - feels like over- optimisation
- make (bank, wavfile) a tuple on creation?
  - but then u can't save to JSON
  - at least not without custom encode/decode
- sample similarity clustering?

### done

- README.md
- bjorklund
- common rhythms
- replace AG filter with dedicated HP filter
- repeats 
- samplehats to implement "proper" repeats
  - repeated note should be the same
- script to initialise samplebass samples
- pluralise demos
- pydub script to detect whitespace at start of reversed samples
- convert s&h lfo to use hex space
- add min value to s&h lfo
- check use of pool.filter, pools.flatten
- don't render pitch if value is zero
- rename curate_pool as filter_pool
- see if slicebeats cli main could use banks.curate_pool
- convery graular to use AudioSegment.empty()
- refactor random grains implementation for new kwargs
- define random grains
- lookup pad and chord terms
- copy slicebeats demo
- implement granular algo
- change search bank dev script curation term 
- check notes re samplebass search terms
- move cli params inline
- curation to use single regex string rather than list of string fragments
- move slicebeats curation terms inline
- test formatting array parameters
- update formatting of mod ctrl
- call apply_cutoff dynamically
- revert samples as pools
- move sampler into directory and nest utils/wavfile
- test show samples
- test fixes
- rename pools as samples
- move sample into pool
- reduce samplebass n to 16 and add notes
- make mod and ctrl params option
- check consistency with existing files
- remove sample.ext
- should be allowed to pass filename to sample
- replace sample.filename with sample["file"]
- replace sample.ext in sampler
- consider if you need to use sample.base_key when creating segments
  - you shouldn't need to include pitch
  - but if you use sample.filename it creates an error
- test samplebass
- initialise samplebass pool
- samplebass to add random cutoffs to cloned samples
- get copy of old pydub enhanced sampler
- sampler to maintain map of segments where slicing required
- sampler cutoff logic
- search for and replace refs to str(sample)
- check for refs to sample.ext
- check for refs to sample["filename"]
- check for refs to sample["filename"]
- add sample properties for base and mod filenames
- remove sample conditional property checking
- remove sample file refs
- remove sample ext refs
- sample decorator to populate sample with blank modifier and tags
- banks to initialise sample with stem and ext
- comment out samplebass bank/pool initialisation stuff
- remove bank spawn stuff
- remove banks search stuff
- remove pool groups stuff
- add notes to acidbass, samplebass showing how thet could be extended
- move banks.py and pools.py into modules root
- only apply cutoff if is less than sample length
- rename apply_ as spawn_
- add groups code into pool.add 
- see if SVSlicePool can be removed [samplebass]
- add subdirs to demos and use date outputs only for acidbass|slicebass
- rename poolterms as curated
- simplify samplebass by calling bank.default_pool
- simplily dev/search_pools by calling bank.default_pool
- replace spawn_free/curated with default_pool property and curate_pool method
- add pools.flatten method
- move globals pool creation to cli
- remove joint spawn_pools property and move pool spawning to cli
- search banks
- rename bank.cutoff as slice_cutoffs
- rename banks.search as banks.filter_bank
- add _pool suffix to spawn_free|curated
- module layout as an option
- new pool class to handle slices
- convert pool to list
- remove banks.slicedxxxx
- migrate archives to include pico- bank prefix
- check archive reanimation
- add tag groups method to bank
- refactor cutoff suffix as a tag (#cutoff-500)
- move fragments into slicebeats and rename as poolterms
- add load_yaml utility referencing file
- move slicebeats modules, machines, links into yaml files
- samplebass to request multiple sizes
- cutoff to accept multiple sizes
- cutoff to add suffix to filename
- banks.search shouldn't override wavfilename
- replace octavox/banks/pico refs
- abstract hex support
- better support for low frequency ranges
- convert acidbass to work in hex space
  - use random.choice not random.random
  - add notes on bias 
    - freq low
	- resonance hi
	- release mid   
- convert SVBanks to be list
- remove acidbass attack
- allow pool.spawn_free to work without tag
- simplify number of times samplebass ref is used in samplebass main block
- add pico- prefix to banks
- failed archive process
  - cp achive/slicebeats/* tmp/slicebeats/json
  - load_project visible
  - archive_project
  - aws s3 ls --bucket octavox-assets
  - (None.json)
- acidbass vel function
- script to re- push archives
- re- check archive reanimation
- refactor archives and save to tmp
- rename Modulator as SampleHoldModulator and remove style
- move SampleHoldModulator into modules/modulator
- replace trig mod/ctrl with target
- filter attack
- resonance
- distortion/echo/reverb
- freq/release scaling (16^4?)
- project checking decorator
- test pattern mutation [hi]
- cli decorator to protect functions which use s3
- replace style mutation with pattern mutation
- rename samplekey instances as sample
- function to check if online
- cli main to check if online
- add search_replace utils
- revert mutate to lo/hi
- add cli enum support
- add lo/mid/hi options to mutate_patch
- add lo/mid/hi options to mutate_patch
- rename mutate_seed as mutate_patch
- custom pool class which can cross- lookup oh/ch
  - remove pool.tags and slicebeats/cli.py check
- s3 state variable
- add banks online/offline
- move fetch_pico into scripts/banks
- refactor id as note
- refactor delay unit so scales with bpm
- chord support
- archive project to put to json struct to s3
- delete local archives
- reanimate projects to list and load from S3
- pass prefix to s3 empty script
- script to push archives to s3
- script to put existing archives to s3
- split banks and pools
- else load from cache
- pass cachedir to bank creation
- makedirs cachedir
- list cached banks
- iterate through S3 banks
- if bankname not in cache, load from S3 and save to cache
- convert bank creation to classmethod 
- rename tmp/picobanks as tmp/banks/pico
- remove octavox/banks
- banks initialisation to load from s3
- dump_pico_banks to push to s3
- add back some kind of pool culling
- oh/ch error when randomising with small pool
- revert default pool to default-curate
- randomise pool action
- add modulator params to archives
- randomise pool on cli start
- move MachineConfig to cli and rename as machines
- remove unpacking of params
- sort list projects
- rename modules as layout
- machine.randomise to initialise object with params
- save params as part of json state and check serialisation
- move reanimate archives to base class
- demos are broken
- circular error if you move SVSampleKey into model
- move nouns and adjectives into cli
- move random filename stuff and nouns and adjectives into cli
- rename cli stub as stem
- add sv prefix to model classes
- move project stuff into model (tracks, trigs)
- archive reanimation script
- migrate archives 
- pass machine around rather than tag ans styles
- move tags into params
- replace eval type upper with class references and proper instantiation
- rename lfo as modulator
- refactor model params and styles munging
- single machines class and refactor patch methods 
- check json serialisation is working
- replace hardcoded class refs with eval type capitalized 
- remove mutes again
- check random filenam
- refactor lfos randomisation and initialisation to look the same as sequencers
- use *args, **kwargs in lfo randomisation for redundant parameters
- nest machine args under params
- pass Seq|LfoConfig from a single place and rename as machines
- rename config as modconfig and links
- move randomise_seed code into cli
- include method in sequencer/lfo config and call dynamically
- remove modules/patterns and move vitling stuff inline
- ensure sequencer has equivalent pattern to sample_and_hold
- add protection to empty bucket action
- scripts to create/list/empty/delete assets bucket
- environment variables
- moved render_patches into root cli
- add cli variables for modules, links
- split config and move inline under separate variables
- check what happens if link module unknown
- resonance parameter
- parameterise filter scaling with cli args
- set filter type in filter config
- refactor filter cutoff scaling to use absolute values
- remove fx value scaling at SVFXTrig level
  - add multipier as slicebeats LFO config variable
- pass seed
- add timestamp as output prefix
- rename limit as density
- random filter levels
- use lookups when loading sa,ples
- pass base sample from command line
- json serialisation error on adding params to samplebass
- test cutoff with samplebass demo
- creation of SVNoteTrig to automatically insert mod into samplekey tags
- move octavox/scripts into new scripts, demos directories
- update credits
- refactor scripts/dump_pico_projects.py
- remove flatten
- fix show_samples
- notes on why samples can't be a pool
- add pool values property
- creation of filtered should use pool.lookup
- refactor samplekeys nomeclature as samples or pool
- pool.lookup() should return another pool
  - model Samples code will need changing
- pass pool to sampler
- samplekey base_key and full_key properties
- eliminate calls to str(samplekey)
- change cutoff, slice to index from 0 and remove protection
- start, end parameters
- cutoff, slice implementations
- move segment handling into decorator
- new sample_key, segment_key fields for samplekey
- use segment key in sampler
- refactor sampler pydub code
- rename sliceparams as simply params
- pool add() method to avoid doing `pool[str(samplekey)]=samplekey`
- move mutation code into cli
- pydub demo to export to in- memory binary data
- new optional samplekey params field which renders as JSON dict in str
- investigate how existing sampler copies data to slot (lookup?)
- move banks into directory and have separate sampler module
- make samplekey tags optional
- tags to be rendered as list at end of str(samplekey)
- ensure tags are sorted in str() for consistency
- remove comment about polymorphic samplers
- consider raising RuntimeError if no samplekeys with mod tag found
- CREDITS.md, INSPIRATION.md
- rename sampler as BankSampler and move into banks
- pydub
  - https://stackoverflow.com/questions/44424874/read-from-bytes-not-filename-to-convert-audio
- dump wavfile
- rename picobeats as slicebeats
- replace Fixes with SVPool
- cull pools on loading
- add samples lookup code which uses full pool if no matches are found
- check samples lookup code
- refactor SVPool as per cli Fixes
- runtime name reference checking
- remove pool validation stuff
- add lookup method to SVPool as per fixes
- convert samples lookup to act polymorphically wrt to pool and fixes
- migrations to save to migrations dir
- dedicate migrations class
- migrate ids to names
- rename id as name
- aws config
- new inline Sequencer/LfoConfig classes which wrap seq_id, lfo_id methods or properties
- link re python pitch shifting
- pass explicit modules and links to project
- move module layout initialisation into modules.py
- move colour stuff into modules.py
- separate layout from project
- separate project name from outside
- consider moving tags out of config
- update archive
- fix bads refs to `%s/%s % (outdir+"/json", etc)`
- samples are badly named (Kick not KK etc)
- need a save project action
- replace sequencer key with id [mod]
- samples is now a list with tags field [array values]
- mutes are no longer part of structure
- density (0.75) is now contained at the root patch level
- replace lfo key with id [mod/ctrl]
- refactor fixes to utilise tag structure
- fixes to become a standard dict
- add lookup method for tag
- fix_sample is failing
- samples to be saved as list
- rename soundkeys as tags
- loading and cloning fails because samplekey isn't converted from dict to SampleKey class on loading project
- add multiple tag support for samplekey
- mutes 
- convert samplekey mod to tag
- density stored at patch level 
- volume and BPM variables
- rename show patch as show samples
- complete refactoring of show_patch
- sequencer to clone samplekey since updating with mod
  - add note re overwriting of module
- trig to use key rather than samplekey ref
- refactor samplekey as soundkey unless it is a samplekey class
- remove mutes
- move flatten, Q into projects/__init__
- move instruments into config and rename as samplegroups 
- refactor key as samplekey in trig class
- rename samplekey, inst as samplegroup
- consider if cli needs to import Instruments
- convert dict- based SV classes to real classes
- refactor use of key for sample randomisation
- see if key can be eliminated from seq/lfo initialisation
- replace key used by init_machine with id parameter
- separate usage of key to a) randomise samples and b) lookup seq/lfo config
- move init_machine inline
- replace passing of key to slice for style lookup, with direct passing of styles
- check if both tracks and trigs need nbeats variable
- model to use trigs class not tracks and to append to trigs
- project to use trigs.tracks
- new SVTrigs class (list) which can spawn Tracks
- new track_key property for trig classes
  - uses mod and/or mod+ctrl
- remove keys from modules and remove associated validation code
- replace sample keys with mod names
- rename svpatch as svtracks
- extend basecli not poolcli (?)
- vitling patterns
- reduce config to single sampler
- pitch shifter
- install pyaudio
- remove instruments
- change sequence to mirror lfo
- remove slices
- remove patterns
- remove mutes
- remove temperature
- remove density
- remove mutate and scatter
- remove picobeats refs
- remove fixes
- remove svdrum
- convert fixes values to use set()
  - check set equality operator
- avoid sample fix duplication
- simplify initialisation of fixes via instrument class which allows you to flatten values
- refactor Samples.randomise 
  - if i==0 and key in fixes and fixes[key]!=[]
- remove pool.randomise
- pass slice index to samples
- add bank.lookup
- remove shortlabel stuff
- arrange action
- mutes
- replace npatches with blocksize and nblocks
- refactor randomisation and mutation to iterate over blocks and patches
- simplify mutation
- move randomisation into cli
- pass filenames containing outdir to patches
- SVTrig class
- encapsulate short_label code in SVTrig
- remove SVSampleKey.create
- add @parse_line type checking
- avoid having to specify @parse_line(config=[])
- refactor current pool indicator
- copy pool to set pool
- copy pool followed by randomise patches fails
- add back wrap_action
  - remove str(frag) to test wrap_action
- remove nbreaks
- remove pitch
- remove mutes
- remove decompile and concat
- SVBankCli
- consider if there are other opportunities to abstract cli
- remove code to create paths on the fly
- abstract base cli
- remove code to create paths on the fly
- cli to be passed output dir and create directory structure
- why do you need a numpy requirement?
- cli history
- move SVEnvironment, random_filename to root
- show_samples to dump short name
- replace show_patch with show_samples
- nero-bellum and pitch-black names aren't being cleaned
- fetch pico stuff to add index prefix to filename
- save pico stuff to picobeats/banks/zipped|projects
- ability to quick view bank list
- load_project fails if passsed string
- show_rendered should be show_samples
- show_rendered doesn't render svdrum trigs
- complete show_samples action 
- check how tmp dirs are being created
- rename chain as decompile
- trig velocity should be an option
- nbreaks should be an option for project rendering
- script to dump pico banks as projects
- add sv prefix to banks, pools etc
- add pitch info to samplekey
- convert samplekey tuples to classes
- complete show samples action by iterating over pattern and dunping formatted row
- implement cli api
- abstract instruments and fragments from banks.py
- move banks.py into modules
- add show() function
- more forensic svdrum mixer levels
- pass config from cli and validate there
- pattern temperature
- check vitling patterns
- try forcing more zero echo wet stuff
- rename patterns.yaml as fragments.yaml?
- svdrum kick volume factors
- refactor sequence render variables
- move code that converts notes to grid into SVPatch
- clean up raw wavfile names 
- rename patterns as fragments
- add SnareDrum for completeness
- svdrum trig needs to switch module to drum
  - single drum module?
  - replace sampler with Drum?
- add svdrum-curated to list of pools
- complete svdrum config
- modify sequence rendering if bank is defined as svdrum 
- validate sequence modules and keys
- validate lfo modules
- abstract single config structure into yaml file
- remove snaredrum as is crap
- add drum modules
- runtime module naming checks
- should be able to rename KKSampler as KickSampler
- check what happens if you change a module key from kk
  - do you need a runtime check here?
- consider moving filter_samples() into SVTrack
- consider renaming patch as tracks
- replace passing of nbeats to init_pattern/blank with property of tracks class
- move patch rendering back into model
- eliminate double call to render
- tracks.render() to return dict so you maintain key information
- load rv/sampler modules dynamically
- move module instantiation and sample gathering into project
  - you might have to walk a structure iteratively in order to find samples
- new concat method taking array
- remove qd
- pattern.randomise classmethod
- add new cli pool method which sets pool
- remove pool from params
- allow param and pool to take blank second arg and work as getters
- fix chain 1000 + mutate 1000
- not convinced chain is generating the right output
- move int parse above array
- handle octachain array conversion inline
- refactor octachain so takes an array of roots 
  - ignores nbeats
  - shouldn't run any mutations itself
- add AxB array support to cli
- fix copy fdest lookup 
  - should lookup prior to creation
- rename chain as octachain
- remove mutate/ chain hack
- copy to use lookups
- (replace clone with add?)
- add pool to add pool to current pool
- convert pool to use set
- pool clone fails
- clone pool to clone existing pool 
- init pool to create empty pool
- `chain 1000` followed by `mutate 1000` returns an error
- check mutate and chain take negative numbers and use moduko
- remove array support 
- remove list prefix from params and pools
- show pool sizes
- @wrap_action is not wrapping errors with (eg) bad density values
- remove env value
- setparam code parsing param updates is a complete mess
- refactor cli validators
  - remove optimistic parse
  - iterate over config with matches_xxx, parse_xxx helpers
- density
- why does it fail with missing sample refs?
- consider ordering rendered tracks
- try eval for validation
- add array support
- remove min handling
- combine parsing of line with parameter validation
- consider adding back cli chain sample munging
- chain mutes are not working
- project -> decorator to attach patch, blank items
- clone error when mutating a loaded file
- shuffle_slice break track idempotency
- should tracks rendering really return n, tracks?
- restrict samples to those used by a particular chain
- avoid duplicating keys
- revert to using keys
- some of the sample offsetting looks very strange (and busy)
- consider not unpacking params at machine level
  - or doing it in a decorator
- chaining fails
- mutation fails

```
 File "/Users/jhw/work/octavox/octavox/projects/picobeats/model.py", line 98, in <listcomp>
    tokens=[int(tok)
ValueError: invalid literal for int() with base 10: ''
```

- mutes arg
- check dual/overloaded calls to constructors
- mutate tracks
- remove cli list support
- initialise samples
- tracks rendering needs to return n, tracks
- remove slicetemp
- pattern initialisation
- slice model 
  - seed, style, samples
- move render_xxx into tracks, lfos
- track patterns and offsets
- merge machines into track and lfo
- relationship between sequencer/lfo Objects and the config items that are used to instantiate them
- lfo json needs to include type and args (range, intervals)
- name parameters when you have long lists
- rename/remove vitling generator
- move lfos from slices to tracks
- abstract vitling beats into common vitling909 module
- zero ctrl values not being rendered
- rename machines as sequencers
- eliminate lfo offsets
- eliminate pattern code from slice rendering
- replace hardcoded instrument lists with config refs
- second feedback lfo
- define lfo mod, controller in config
- separate machine kwargs code at slice level
- remove lfo style
- remove lfo array support
- wet changes not being rendered
- convert append/expand into dual decorator strategy
- list, array support
- revert renderinfo
- env and pool to share common base with abbreviation lookup
- reduce default temperatures
- rename samples as poolname
- add poolname abbreviation matching
- replace enum support with string
  - special setparam code to validate pools
- cli variable to list pools
- make nbeats an environment variable
- move banks into /octavox/banks/pico where they can be shared
  - Banks class also
- pass banks and pool to model
- cli to initialise pools
- cli poolname variable
- banks function to return file handle for bankname/wavfile
- pools.trim to reject anything too small
- pools.spawn_free/curated to add global pools
- remove cli profile variable
- curation script
- remove s3 stuff
- download into local banks directory with unchanged names
- rename slicebeats as picobeats
- remove save
- insert nbreaks automatically but for chain only
  - remove parameter
- define instruments and solos
- chainer to force samples to be the same as mute
- saving
- chainer with mutes
- refactor breaks so they are not voids
- complete load function
- add breaks variable
- add bool support
- simplify os.makedirs
- don't store self.filenmae
- remove pico- prefix from saved s3 files
  - test upload/download again
- include generator in filename
- remove stack
- fix need to remove pico- when downloading sample files
- save patches to json
- remove blender
- maintain internal stack of patches
